version: '3.9'

services:

  selenoid:
    image: aerokube/selenoid:latest
    container_name: selenoid
    command:
      - -limit
      - "5"
      - -timeout
      - 5m
      - -service-startup-timeout
      - 120s
      - -session-attempt-timeout
      - 120s
      - -conf
      - /etc/selenoid/browsers.json
      - -video-output-dir
      - /opt/selenoid/video
      - -log-output-dir
      - /opt/selenoid/logs
      - -container-network
      - selenoid-net
    environment:
      TZ: Europe/Moscow
      OVERRIDE_VIDEO_OUTPUT_DIR: /opt/selenoid/video/
    volumes:
      - ./browsers.json:/etc/selenoid/browsers.json:ro
      - ./video:/opt/selenoid/video
      - ./logs:/opt/selenoid/logs
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      - selenoid-net
    ports:
      - "4444:4444"

  selenoid-ui:
    image: aerokube/selenoid-ui:latest
    container_name: selenoid-ui
    command:
      - --selenoid-uri
      - http://selenoid:4444
    environment:
      TZ: Europe/Moscow
    depends_on:
      - selenoid
    ports:
      - "8080:8080"
    networks:
      - selenoid-net

  ggr:
    image: aerokube/ggr:latest-release
    container_name: ggr
    restart: always
    depends_on:
      - selenoid
    networks:
      - selenoid-net
    ports:
      - "4445:4444"
    volumes:
      - ./config/users.htpasswd:/etc/grid-router/users.htpasswd:ro
      - ./config/quota:/etc/grid-router/quota:ro

  ggr-ui:
    image: aerokube/ggr-ui:latest-release
    container_name: ggr-ui
    restart: always
    depends_on:
      ggr:
        condition: service_started
    environment:
      GGR_HOST: ggr
      GGR_PORT: 4444
    ports:
      - "8888:8888"
    networks:
      - selenoid-net
    volumes:
      - ./config/users.htpasswd:/etc/grid-router/users.htpasswd:ro
      - ./config/quota:/etc/grid-router/quota:ro



networks:
  selenoid-net:
    name: selenoid-net
    driver: bridge
